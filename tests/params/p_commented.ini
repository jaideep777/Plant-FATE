# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Input parameters for Simulations
# If you change the order of parameters below, you will get what you deserve
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

> STRINGS 
# # > DIR
# Directories for data output 
# If met/co2 should not be read/updated from file, set metFile/co2File to "null"
# Traits file should have the following columns in order: 
#       Family, Species, blank column, blank column, Wood density (g cm-3), Max height (m), LMA (g m-2), P50 (MPa), further columns are ignored.
# Note: The number of species must be specified below, and should be <= the number of species in the traits file. 
#       This is just a convenience feature to allow simulations with different numbers of prescribed species
traitsFile      tests/data/Traits_random_HD2.csv

# Metfile must have the following columns in order: 
#      Year, Month, Temp (deg C), VPD (hPa), PAR (umol m-2 s-1), PAR_max (umol m-2 s-1), SWP (-MPa, i.e., absolute value), further columns are ignored
metFile         tests/data/MetData_AmzFACE_Monthly_2000_2015_PlantFATE.csv

# CO2 file must have the following columns in order:
#      Year, CO2 (ppm)
co2File         tests/data/CO2_ELE_AmzFACE2000_2100.csv

outDir  		pspm_output_36sims		    # output dir name, output path will be Plant-FATE-dir/outDir
exptName 	 	XXXXX						# expt name - results will be stored in outDir/exptName

emgProps        AmzFACE_D_PFATE_ELE_HD.txt        # Output filename to output yearly community-level emergent properties e.g. GPP, LAI, VCMAX 
cwmAvg          AmzFACE_Y_mean_PFATE_ELE_HD.txt   # Output filename to output yearly community-weighted-mean species-level properties e.g. density, mortality, basal area
cwmperSpecies   AmzFACE_Y_PFATE_ELE_HD.txt        # Output filename to output yearly species-specific properties as above
traits          traits_ELE_HD.txt                 # Output filename for species-specific evolving trait values 

solver          IEBT  # PSPM Solver to be used - Keep this IEBT. IFMU could be used if IEBT fails, but it is not very accurate

evolveTraits    no    # Whether traits should evolve via oligomorphic dynamics

saveState             yes    
savedStateFile        pf_saved_state.txt
savedConfigFile       pf_saved_config.ini

# stateFile and configFile if simulation should continue from a saved state. Otherwise, specify "null" 
continueFromState     null # pspm_output11/test_spinup/pf_saved_state.txt  # Set to null if fresh start desired
continueFromConfig    null # pspm_output11/test_spinup/pf_saved_config.ini # Set to null if fresh start desired


> SCALARS
# ** 
# ** Solver parameters
# **
resolution     5    # This is the initial number of cohorts in IEBT solver or grid resolution in IFMU. For IEBT, a low number is fine unless a specific initial density is desired.
timestep       0.04166666666666666666666 # 0.0833333333333 # internal solver timestep in years, if a fixed-timestep solver such as IEBT or IFMU is used
T_cohort_insertion    1    # cohort insertion timestep (years). In the current setup, this is used in step_to calls, and cohort insertion is synced with step_to

saveStateInterval     1000  # I think this is currently unused.

# **
# ** Simulation parameters
# **
nSpecies       100    # Number of species to simulate. Traits file should contain at least these many rows
year0          1000   # simulation start year (AD)
yearf          2000   # simulation end year (AD)
nPatches       3      # Not used

# **
# ** Core traits (default values, will be overrriden by values in traits file)  
# **
lma            0.122 # 0.1163 # leaf mass per leaf area [kg/m2]
zeta           0.20			# fine root mass per leaf area [kg/m2] 0.7
fcr            0.47         # coarse root mass per unit stem mass   [REF: GRoot database]
hmat           29.18		# maximum height [m]
fhmat          0.8          # height at reproductive maturity as fraction of hmat [Guesstimate]
seed_mass      3.8e-5	    # [kg]
wood_density   690	        # [kg/m3]
p50_xylem      -2.29        # Xylem P50 [MPa]  -4.515

# p50_leaf     -1.5		# Leaf hydraulic capacity [MPa]
K_leaf         0.5e-16		# Leaf conductance [m]  ---> Calibrated to gs
K_xylem        4e-16		# Leaf conductance [m]
b_leaf         1			# Shape parameter of leaf vulnerabilty curve [-] (Ref: Joshi et al 2022)
b_xylem        1            # Shape parameter of xylem vulnerabilty curve [-] 

# **
# ** Phydro paramaters  
# **
kphio          0.087       # Quantum yield efficiency
alpha          0.1008      # Cost of maintaining photosynthetic capacity (Ref: Joshi et al 2022, removed shrubs and gymnosperms)
gamma          1.1875       # Cost of maintaining hydraulic pathway  (Ref: Joshi et al 2022, removed shrubs and gymnosperms)     


# **
# ** Allocation and geometric paramaters  
# **
m   1.5	 # crown shape paramaters
n   3
fg  0.1  # upper canopy gap fraction

a   75     # height-diameter allometry 114
c   6000   # crown area allometry
b   0	   # bark allometry


# ** LAI model (currently not used)
optimize_lai          0  # 1 # Should crown LAI be optimized at every timestep? - set to 0.
Cc                    0.3  # Leaf construction costs per unit mass 
Chyd                  0.00
response_intensity    3  # speed of LAI response. This gives ~3 months response lag
lai_deriv_step     1e-4  # stepsize to calculate profit derivative wrt LAI
max_alloc_lai		0.5	 # max fraction of npp that can be allocated to LAI increment
lai0                  1.8  # initial LAI - Guesstimate, Li et al (2014)

# **
# ** Leaf Economics
# **
# For all values below, Ref: Wang et al 2021 Leaf economics)
les_u             768   # [dimensionless]
les_k1             24.5   # g biomass / mol CO2 (see cbio below)
les_k2           0.0864   # (mol-CO2/day) / (umol-CO2/s)
les_hT_dH         65.33e3  # J mol-1
les_hT_c          26.35   # - 
les_molar_R       8.31    # J mol-1 K-1
les_cc            13    # dimensionless    (Ref: Colin)

# ** 
# ** Respiration and turnover 
# **
rd  0.011                 # ratio of leaf dark respiration rate to vcmax [-]  (Ref: 0.011 in Farquhar et al 1980, 0.015 in Collatz et al 1991)
rr  0.123                 # Fine root respiration rate per unit biomass per unit productivity [m2 kg-1]    0.4*1e3*1e-4*12/0.6/6.5 = 0.4 [MgC ha-1 mo-1] * 1e-3 [kgC/MgC] * 12 [mo yr-1] * 1e-4 [ha m-2] / 0.6 [m_fr, kgC m-2] / 6.5 [GPP kg m-2 yr-1] = [yr-1] / [GPP kg m-2 yr-1]   (0.4 from Doughty et al 2017 biotropica)
rs  0.020                  # sapwood respiration rate per unit sapwood mass [yr-1] ---> Calibrated to NPP

# ll   0.5   # leaf lifespan [yr]
# lr   1     # fine root lifespan [yr]

cbio 2.45e-2    # kg biomass per mol CO2 = 12.011 gC / mol CO2 * 1e-3 kgC/gC * 2.04 kg biomass/kgC
y    0.75		# yield factor accounting for growth respiration Ref: Educated guess, also used in other models)

k_light	0.5		# Light extinction coefficient

# ** 
# ** Demographics
# **
a_f1 0.15    # Max fraction of biomass invested into reproduction
a_f2 10      # steepness of switch to reproduction

ll_seed  15   # seed lifespan in dormant pool (seed avg dormancy)


# **
# ** Dispersal and germination
# **
Sd            1e-5     # probability of survival during dispersal  --> Calibrated to various
npp_Sghalf    0.5      # Required productivity for 50% probability of survival during germination --> Guesstimate

# **
# ** Mortality
# ** 
# mI      0.002    # 0.002 natural mortality rate
# mD      0.008    # 0.001 mortality rate due to diameter
# mD_e    0.2     # exponent in mortality rate due to diameter
# mS      1      # 0.0  scaling of rgr in mortality rate due to carbon starvation
# mS0     1e-4   # mort = -log(mS0 + mS*rgr)

# mS0    1    # used for mort = mS0*exp(-mS*rgr)
# mS     10 # 5000      

# Parameters of mortality function
# exp(c0 + clnD*log(D) + cD*D + cWD*(wd*wd-cWD0*cWD0) + par.cS0*exp(-par.cS*bp.dmass_dt_tot))
# c0     -5
# clnD   -0.3
# cD      0.2
# cWD    -1.48
# cWD0    0.690
# cS0     0   # 1
# cS      10

# r = c0 + cL*log(L) + clnD*log(D) + cD*(D) + cG*log(rgr*D) + cWD*(WD - cWD0)
# M = 1/(1+exp(-r))
# These below are unused
 c0     -5   # a
 cL      0 # 0.15   # b
 clnD    0 # -1   # c
 cD      0.005  # d
 cG      -2 # -0.35   # e
 cWD    -0.05
 cS0     0

# These are used in current mortality model
 cD0     0.08  # cD0*(D)^eD0             # ** Calibrated to BA, AGB **
 eD0     1.3                             # ** Calibrated to size distribution **
 cD1     0.05  # cD1*exp(-D/0.01)   

 m_alpha  0.0598             # Falster et al 
 m_beta   18.7159
 m_gamma  0.0094
 eWD_alpha -1.1493
 eWD_gamma -1.8392
 cWD0     600
 eWD      -1.0

# **
# ** Disturbance
# **
T_return              1000000       # return interval of disturbance. When a disturbance occurs, the patch is cleared
T_seed_rain_avg       0.099     # years over which seed rain is averaged
T_invasion            20        # A new species is added after every T_invasion years

> ARRAYS
# > PARAM_SWEEPS
# parameter sets to loop over. These override any of the parameters set above.
# all of these MUST BE SET AFTER particle-system initialization. 
# 	  else, particleSystem will initialize with 1st value in these vectors by default 
# c_full = 0.1 0.12 0.14 0.16 0.19 0.22 0.26 0.3 0.35 0.41 0.48 0.56 0.65 0.77 0.89 1.05 1.22 1.43 1.67 1.96 2.29 2.68 3.13 3.66 4.28 5 5.85 6.84 8 9.36 10.95 12.8  -1
# cS_full = 20 40 60 80 100 120 140 160 180 200 220 240 260 280 300 320 -1
# c = 0.1 0.14 0.19 0.26 0.35 0.48 0.65 0.89 1.22 1.67 2.29 3.13 4.28 5.85 8 10.95 -1
# c_offset = 0.12 0.16 0.22 0.3 0.41 0.56 0.77 1.05 1.43 1.96 2.68 3.66 5 6.84 9.36 12.8 -1
# bvec		0.0002 0.002 0.02 0.2 -1


